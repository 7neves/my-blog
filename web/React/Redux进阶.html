<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1. 进阶：中间件middleware | Seven&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="积跬步以至千里，积小流以成江海">
    
    <link rel="preload" href="/assets/css/0.styles.9a488dde.css" as="style"><link rel="preload" href="/assets/js/app.8fcb3c07.js" as="script"><link rel="preload" href="/assets/js/2.ea4b5fde.js" as="script"><link rel="preload" href="/assets/js/26.cfb8865a.js" as="script"><link rel="preload" href="/assets/js/3.482fc7d1.js" as="script"><link rel="prefetch" href="/assets/js/10.ceaff0cb.js"><link rel="prefetch" href="/assets/js/11.602a1a57.js"><link rel="prefetch" href="/assets/js/12.7c9a3565.js"><link rel="prefetch" href="/assets/js/13.cb26c009.js"><link rel="prefetch" href="/assets/js/14.db9f58ed.js"><link rel="prefetch" href="/assets/js/15.c07f99aa.js"><link rel="prefetch" href="/assets/js/16.bbea5198.js"><link rel="prefetch" href="/assets/js/17.bd355204.js"><link rel="prefetch" href="/assets/js/18.069c6795.js"><link rel="prefetch" href="/assets/js/19.2d2f3f2c.js"><link rel="prefetch" href="/assets/js/20.4bf50484.js"><link rel="prefetch" href="/assets/js/21.1bfa4a30.js"><link rel="prefetch" href="/assets/js/22.9b54ca32.js"><link rel="prefetch" href="/assets/js/23.17047d1d.js"><link rel="prefetch" href="/assets/js/24.d36a307c.js"><link rel="prefetch" href="/assets/js/25.f5c553f3.js"><link rel="prefetch" href="/assets/js/27.8d7291fd.js"><link rel="prefetch" href="/assets/js/28.ac3b40d5.js"><link rel="prefetch" href="/assets/js/29.d97a3e56.js"><link rel="prefetch" href="/assets/js/30.f58a4260.js"><link rel="prefetch" href="/assets/js/31.9294edd4.js"><link rel="prefetch" href="/assets/js/32.753d88bb.js"><link rel="prefetch" href="/assets/js/33.4259510b.js"><link rel="prefetch" href="/assets/js/34.767c2061.js"><link rel="prefetch" href="/assets/js/35.ee551374.js"><link rel="prefetch" href="/assets/js/36.67e65bf0.js"><link rel="prefetch" href="/assets/js/37.39a7a34a.js"><link rel="prefetch" href="/assets/js/4.6162bcf8.js"><link rel="prefetch" href="/assets/js/5.43fabd26.js"><link rel="prefetch" href="/assets/js/6.bfd296f5.js"><link rel="prefetch" href="/assets/js/7.da21fdf7.js"><link rel="prefetch" href="/assets/js/8.13301773.js"><link rel="prefetch" href="/assets/js/9.d46e2aae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a488dde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Seven's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  web前端
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  web前端
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/React/React基础.html" class="sidebar-link">React基础</a></li><li><a href="/web/React/如何开发React应用.html" class="sidebar-link">如何开发React应用</a></li><li><a href="/web/React/Redux基础.html" class="sidebar-link">Redux基础</a></li><li><a href="/web/React/Redux进阶.html" class="active sidebar-link">Redux进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_1-进阶-中间件middleware" class="sidebar-link">1. 进阶：中间件middleware</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_1-中间件的概念" class="sidebar-link">1. 中间件的概念</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_2-中间件的使用" class="sidebar-link">2. 中间件的使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_2-进阶-redux-中的异步" class="sidebar-link">2. 进阶：Redux 中的异步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_1-通过请求初始化-store-中的-state" class="sidebar-link">1. 通过请求初始化 store 中的 state</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_2-redux-thunk" class="sidebar-link">2. redux-thunk</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_3-进阶-react-redux" class="sidebar-link">3. 进阶：react-redux</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_1-安装" class="sidebar-link">1. 安装</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_2-容器组件和展示组件" class="sidebar-link">2. 容器组件和展示组件</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_3-connect" class="sidebar-link">3. connect()</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_4-provider-组件" class="sidebar-link">4. &lt;Provider&gt; 组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_4-其他常用中间件及工具" class="sidebar-link">4. 其他常用中间件及工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_1-开发调试工具-redux-devtools-extension" class="sidebar-link">1. 开发调试工具：redux-devtools-extension</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_2-日志记录-redux-logger" class="sidebar-link">2. 日志记录：redux-logger</a></li><li class="sidebar-sub-header"><a href="/web/React/Redux进阶.html#_3-其他工具集" class="sidebar-link">3. 其他工具集</a></li></ul></li></ul></li><li><a href="/web/React/从零开始实现一个Redux.html" class="sidebar-link">从零开始实现一个Redux</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react-router</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>UmiJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Utils</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/web/Mobile.html" class="sidebar-link">Mobile</a></li><li><a href="/web/ElementUI.html" class="sidebar-link">ElementUI</a></li><li><a href="/web/FastMock.html" class="sidebar-link">fastmock</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-进阶-中间件middleware"><a href="#_1-进阶-中间件middleware" class="header-anchor">#</a> 1. 进阶：<a href="https://www.redux.org.cn/docs/advanced/Middleware.html" target="_blank" rel="noopener noreferrer">中间件<code>middleware</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h2> <h3 id="_1-中间件的概念"><a href="#_1-中间件的概念" class="header-anchor">#</a> 1. 中间件的概念</h3> <p>在Redux的执行流程中，如果想要添加一些额外的操作，应该添加在哪里会合适呢？</p> <ul><li>reducer：是纯函数，只承担计算 State 的功能，不适合也承担不了其他功能，因为，纯函数不能进行读写操作。</li> <li>View：与 State 一一对应，可以看做是 State 的视图层，也不适合承担其他功能。</li> <li>Action：存放数据的对象，消息的载体，只能被操作，自身不能进行任何操作。</li></ul> <p>综上所述，都不太适合进行额外的操作，但是还有一个阶段，在发出 Action 的时候，即 <code>store.dispatch()</code> ，是可以额外添加一些操作的。例如一个打印日志的功能，把 Action 和 State 打印出来，可以对 <code>store.dispatch()</code> 进行如下改造：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> next <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch<span class="token punctuation">;</span>
<span class="token comment">// 改造dispatch方法：</span>
store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatching'</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 action</span>
  <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行dispatch自身的功能，派发action</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new state'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印新的 state</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面对 <code>store.dispatch</code> 方法进行了改造，在派发 Action 前后额外添加了一些新的功能。这就是中间件的功能。<br> <strong>中间件就是一个函数，对 <code>store.dispatch()</code> 方法进行改造增强，在发出 Action 和执行 Reducer 之间，添加一些新的功能</strong>。<br> <img src="https://i.loli.net/2020/02/16/2T5PNnk3HJLtDVc.png" alt=""></p> <h3 id="_2-中间件的使用"><a href="#_2-中间件的使用" class="header-anchor">#</a> 2. 中间件的使用</h3> <p>Redux提供了很多现成的中间件，这里先知道如何使用就行。</p> <ul><li>Redux提供了 <a href="https://www.redux.org.cn/docs/api/applyMiddleware.html" target="_blank" rel="noopener noreferrer"><code>applyMiddleware(...middlewares)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法来实现中间件；</li> <li>而中间件需要在创建 Store 的时候进行注入，以便所有的 <code>dispatch</code> 都能使用到。Redux创建 Store 的方法是 <code>createStore()</code> ，所以将扩展的功能放入 <code>applyMiddleware()</code> 之后再传入 <code>createStore()</code> 方法中，就完成了 <code>store.dispatch()</code> 功能的增强。<br>
如日志扩展中间件：</li></ul> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Logger <span class="token keyword">from</span> <span class="token string">'redux-logger'</span><span class="token punctuation">;</span>  <span class="token comment">// 需要先安装 npm i -D redux-logger</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>Logger<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li><strong>注意：</strong> <ul><li><code>applyMiddleware(...middlewares)</code> 中 <code>middlewares</code> 参数应该为一个函数。</li> <li><a href="https://www.redux.org.cn/docs/api/createStore.html" target="_blank" rel="noopener noreferrer"><code>createStore(reducer, [preloadedState], enhancer)</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 方法接收整个应用的初始状态作为参数，那样的话，<code>applyMiddleware</code> 应该为第三个参数<div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  initial_state<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>Logger<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div></li> <li>中间件是有次序的，使用前需要先查看使用规则，如下 <code>logger</code> 插件必须放在最后<div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">,</span> promise<span class="token punctuation">,</span> logger<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h2 id="_2-进阶-redux-中的异步"><a href="#_2-进阶-redux-中的异步" class="header-anchor">#</a> 2. 进阶：Redux 中的异步</h2> <p>Redux 的基本工作流程是：用户发出 Action ，Reducer 函数算出新的 State ，View 重新渲染。该过程都是同步的，Action 发出以后，Reducer 立即就能算出State 。</p> <ul><li>vuex 中的异步<br>
在vuex中，只有mutation可以改变state，而mutation也是无法异步执行的；但是提供的 action 是可以实现异步的，所以一般都在组件中通过 dispatch 触发action，然后 action 再 commit 对应的 mutation 来实现异步操作。</li> <li>Redux中的异步<br>
在Redux中需要借助中间件-<code>middleware</code> 来实现异步。</li></ul> <h3 id="_1-通过请求初始化-store-中的-state"><a href="#_1-通过请求初始化-store-中的-state" class="header-anchor">#</a> 1. 通过请求初始化 store 中的 state</h3> <p>在 react 中请求操作基本都是在 <code>componentDidMount</code> 阶段完成的，下面以 axios 请求为例实现一个简单的后台请求初始化 store 中的 state 。这个例子不牵涉到中间件以及 action 异步的概念，以助于后面进行区分理解：<span id="AsyncApp"></span></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 构建 action </span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">INIT_LIST</span> <span class="token operator">=</span> <span class="token string">'INIT_LIST'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initList</span><span class="token punctuation">(</span><span class="token parameter">list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token constant">INIT_LIST</span><span class="token punctuation">,</span>
    list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2. 构建reducer </span>
<span class="token keyword">function</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">INIT_LIST</span><span class="token operator">:</span>
      <span class="token comment">// 从后台获取数据初始化list</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>action<span class="token punctuation">.</span>list<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 3. 在组件中发送请求</span>
<span class="token keyword">class</span> <span class="token class-name">AsyncApp</span> <span class="token keyword">from</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://www.fastmock.site/mock/76aa0120ec70a57f3b8244c0db92149f/test/test'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>list<span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token comment">// 4. 完成初始化操作</span>
      store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">initList</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样看来很简单，确实也没什么复杂的，接着往下看。</p> <h3 id="_2-redux-thunk"><a href="#_2-redux-thunk" class="header-anchor">#</a> 2. <code>redux-thunk</code></h3> <ol><li><p>异步操作的思路<br>
上文说到如果要执行同步操作，直接发出一个 Action 即可。那么异步操作的话，还需要有一个异步操作的结果，所以异步操作至少得发出两个 Action：</p> <ul><li>即操作时发起的 Action ，表示“正在操作”;</li> <li>异步操作结束之后发起的 Action（包含两种结果：操作成功和操作失败，立即想到了 Promise），来表示“操作结束”。</li></ul> <p>那么就需要定义三个 action 来表示三种状态，这里可以有两种写法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一种：不同的 action type</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'FETCH_POSTS_REQUEST'</span> <span class="token punctuation">}</span> <span class="token comment">// 表示发出请求</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'FETCH_POSTS_SUCCESS'</span><span class="token punctuation">,</span> response<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token comment">// 表示请求成功</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'FETCH_POSTS_FAILED'</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token string">'error info'</span> <span class="token punctuation">}</span> <span class="token comment">// 表示请求失败</span>
<span class="token comment">// 第二种：相同的 action type（都代表请求），不同的参数，表示不同的状态</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'FETCH_POST'</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'FETCH_POST'</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span> response<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'FETCH_POST'</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token string">'error info'</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>实现异步操作<br>
根据上面描述的异步操作的思路，第一步的同步 action 很简单，直接像正常一样 dispatch 即可；如何在操作结束后，自动触发第二个 action 是关键，奥妙就在 Action Creator （action 创建函数）之中。按照异步思路，应当是如下的一个函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里返回的是一个函数</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">requestAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求前触发一个 action </span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'APIPath'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">successAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求结束成功后触发一个 action </span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">failedAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 请求结束失败后触发一个 action </span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那么构建到 Redux 中结合<a href="#AsyncApp">通过请求初始化 store 中的 state 的例子</a>，应当是如下的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 构建一个返回函数的 action</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getInitialList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">loadingAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://www.fastmock.site/mock/76aa0120ec70a57f3b8244c0db92149f/test/test'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          <span class="token comment">// 这里可以对结果进行操作，包括 json 化处理</span>
          <span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token comment">// 将数据部分传递到下一个 then</span>
          <span class="token comment">// 不要使用 catch，因为会捕获</span>
          <span class="token comment">// 在 dispatch 和渲染中出现的任何错误，</span>
          <span class="token comment">// 导致 'Unexpected batch number' 错误。</span>
          <span class="token parameter">error</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'An error occurred.'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token punctuation">{</span> list <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
          <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">initList</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在组件中使用</span>
<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getInitialList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以发现这里的 initListAction 为一个函数</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getInitialList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>redux-thunk</code> - <strong>使 <code>dispatch()</code> 能够接受一个函数作为参数</strong><br>
上面代码中， <code>getInitialData</code> 是一个 Action Creator ，返回的是一个函数。这个函数在执行时，会先发出一个 action (<code>loadingAction()</code>)，然后进行异步操作。拿到结果后，先处理结果，然后再发出一个 action (<code>initList(list)</code>)。这里需要注意这几个不同点：</p> <ul><li>这里的 <code>getInitialList()</code> 返回了一个函数，而 Action Creator 默认返回的是一个对象</li> <li>返回函数的参数是 <code>dispatch</code> 和 <code>getState</code> 这两个 Redux 方法，而普通的 Action Creator 的参数是 Action 的内容</li> <li>在返回的函数中，先发出一个 Action (<code>loadingAction()</code>)，表示异步操作开始</li> <li>异步操作结束后，再发出一个 Action (<code>initList(list)</code>)，表示操作结束<br>
经过这样的处理，就解决了自动触发第二个 Action 的问题。但是，新的问题又来了， <code>store.dispatch()</code> 方法正常情况下，参数只能是对象，不能是函数。这时，<code>redux-thunk</code> 终于登场啦。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducers'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>使用 <code>redux-thunk</code> 中间件，改造增强 <code>store.dispatch()</code>，使之可以接收函数作为参数。
因此，异步操作的第一种解决方案就是，构造一个返回函数的 Action Creator，然后使用 <code>redux-thunk</code> 中间件来改造增强 <code>store.dispatch</code>，使之能接收函数的参数。</p></li></ol> <h2 id="_3-进阶-react-redux"><a href="#_3-进阶-react-redux" class="header-anchor">#</a> 3. 进阶：<code>react-redux</code></h2> <h3 id="_1-安装"><a href="#_1-安装" class="header-anchor">#</a> 1. 安装</h3> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -S react-redux
</code></pre></div><h3 id="_2-容器组件和展示组件"><a href="#_2-容器组件和展示组件" class="header-anchor">#</a> 2. 容器组件和展示组件</h3> <ol><li><p>分离思想<br> <code>react-redux</code> 是基于 <a href="https://juejin.im/post/5a52fe32f265da3e317e008b" target="_blank" rel="noopener noreferrer">容器组件（Smart/Container Components）和展示组件（Dumb/Presentational Components）相分离<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的开发思想。总结一下它们的不同点：</p> <table><thead><tr><th style="text-align:right;"></th> <th style="text-align:left;">展示组件</th> <th style="text-align:left;">容器组件</th></tr></thead> <tbody><tr><td style="text-align:right;"><strong>作用</strong></td> <td style="text-align:left;">描述如何展示（样式、骨架）</td> <td style="text-align:left;">描述如何运行）（数据获取、状态更新）</td></tr> <tr><td style="text-align:right;"><strong>直接使用 Redux</strong></td> <td style="text-align:left;">否</td> <td style="text-align:left;">是</td></tr> <tr><td style="text-align:right;"><strong>数据来源</strong></td> <td style="text-align:left;">props</td> <td style="text-align:left;">监听 Redux state</td></tr> <tr><td style="text-align:right;"><strong>数据修改</strong></td> <td style="text-align:left;">从 props 调用回调函数</td> <td style="text-align:left;">向 Redux 派发 actions</td></tr> <tr><td style="text-align:right;"><strong>调用方式</strong></td> <td style="text-align:left;">手动</td> <td style="text-align:left;">通常由 <code>react-redux</code> 生成</td></tr></tbody></table></li> <li><p>UI 组件的特征</p> <ul><li>只负责 UI 呈现，不带任何业务逻辑</li> <li>无状态（即不使用 <code>this.state</code> 这个变量）</li> <li>所有数据都由参数（<code>this.props</code>）提供</li> <li>不使用任何 Redux 的 API</li></ul> <p>如下，是一个完整的 List UI组件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> List <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">TodoList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> list<span class="token punctuation">,</span> removeItem <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>List
      dataSource<span class="token operator">=</span><span class="token punctuation">{</span>list<span class="token punctuation">}</span>
      bordered
      renderItem<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>List<span class="token punctuation">.</span>Item onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">removeItem</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span>item<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>List<span class="token punctuation">.</span>Item<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>因为UI组件不包含任何状态，又叫无状态组件，纯组件，即同纯函数一样，由参数确定它的值</p></li> <li><p>容器组件的特征<br>
容器组件与UI组件的特征恰恰相反</p> <ul><li>负责管理数据和业务逻辑，不负责 UI 的呈现</li> <li>带有内部状态，由 Redux 提供</li> <li>使用 Redux 的 API</li></ul></li> <li><p>总结<br>
总之，只要记住一句话就可以了：<strong>UI 组件负责 UI 的呈现，容器组件负责管理数据和逻辑。</strong><br>
在初期尝试做分离时，注意：</p> <blockquote><p>不要把分离 presentational 组件和 container 组件当做一种教条。有时候并没那么重要或很难划清界限，如果你不确定一个组件该是 presentational 组件或 container 组件，也许是决定的太早了。别担心！</p></blockquote></li></ol> <h3 id="_3-connect"><a href="#_3-connect" class="header-anchor">#</a> 3. connect()</h3> <p>React-Redux 规定，所有的 UI 组件都由用户提供，容器组件则是由 React-Redux 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。而  <code>connect()</code> ，就是 <code>react-redux</code> 提供的用于从 UI 组件生成容器组件的方法。</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>；
<span class="token keyword">import</span> TodoListUI <span class="token keyword">from</span> <span class="token string">'./components/TodoListUI'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> TodoListContainer <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TodoListUI<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面代码中，TodoListUI 是 UI 组件，TodoListContainer 就是由 React-Redux 通过 connect 方法自动生成的容器组件。<br>
但是，这种容器组件中没有定义业务逻辑，所以它是无意义的，只是 UI 组件的一个单纯的包装层。为了定义业务逻辑，需要给出两方面的信息：</p> <ul><li><strong>输入逻辑</strong>：外部的数据（即state对象）如何转换为 UI 组件的参数</li> <li><strong>输出逻辑</strong>：用户发出的动作如何变为 Action 对象，从 UI 组件传出去。</li></ul> <p><code>connect</code> 是连接的意思，也就是把这些业务逻辑和UI组件相连起来，才能构成一个有意义的容器组件。所以，完整的容器组件应当是这样的：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>；
<span class="token keyword">import</span> TodoListUI <span class="token keyword">from</span> <span class="token string">'./components/TodoListUI'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> TodoListContainer <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoListUI<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-mapstatetoprops"><a href="#_1-mapstatetoprops" class="header-anchor">#</a> 1. mapStateToProps()</h4> <ul><li><strong><code>mapStateToProps()</code> 是一个函数</strong>。它的作用就是像它的名字那样，建立一个从（外部的）state对象到（UI 组件的）props对象的映射关系。</li> <li>它的<strong>返回值是一个对象</strong>，里面的每一个键值对就是一个映射。</li> <li>它的<strong>第一个参数为 <code>state tree</code></strong> ，即 store 中的 state tree 对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">mapStateToPorps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    list<span class="token operator">:</span> state<span class="token punctuation">.</span>list
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面代码就表示将 state tree 中的 list 属性映射为 UI 组件中 props 对象的 list 属性，从而获取到它的值。</p> <p><code>mapStateToProps()</code> 会自动订阅 Store，每当state更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</p> <ul><li>它的<strong>第二个参数为UI组件的<code>props 对象</code></strong><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 容器组件的代码</span>
<span class="token comment">//    &lt;FilterLink filter=&quot;SHOW_ALL&quot;&gt;</span>
<span class="token comment">//      All</span>
<span class="token comment">//    &lt;/FilterLink&gt;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> ownProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    active<span class="token operator">:</span> ownProps<span class="token punctuation">.</span>filter <span class="token operator">===</span> state<span class="token punctuation">.</span>visibilityFilter
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><strong>注意</strong>：使用 <code>ownProps</code> 作为参数后，如果容器组件的参数发生变化，也会引发 UI 组件重新渲染。</li></ul> <p><code>connect()</code> 方法可以省略 <code>mapStateToProps</code> 参数，那样的话，UI 组件就不会订阅Store，就是说 Store 的更新不会引起 UI 组件的更新。</p> <h4 id="_2-mapdispatchtoprops"><a href="#_2-mapdispatchtoprops" class="header-anchor">#</a> 2. mapDispatchToProps()</h4> <p><code>mapDispatchToProps()</code> 是 connect 函数的第二个参数，用来建立 UI 组件的参数到store.dispatch方法的映射。也就是说，<strong>它定义了哪些用户的操作应该当作 Action，传给 Store</strong>。它可以是一个函数，也可以是一个对象。</p> <ul><li><code>mapDispatchToProps()</code> 函数的参数为 <code>dispatch()</code> 方法</li> <li>返回值为一个对象，键值为期望注入到UI组件的 props 中的回调方法，来派发 Action</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> removeItem <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../actions'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToPorps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">removeItem</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-provider-组件"><a href="#_4-provider-组件" class="header-anchor">#</a> 4. <code>&lt;Provider&gt;</code> 组件</h3> <p><code>connect()</code> 方法生成容器组件以后，需要让容器组件拿到state对象，才能生成 UI 组件的参数。一种方式是把它以 props 的方式传入到所有容器组件中。但这样太麻烦了，因为必须要用 <code>store</code> 把 UI 组件包裹一层。<br>
React-Redux 提供  <code>Provider</code> 组件，可以让所有容器组件都能访问 store，从而获取到 state ，而不用显式地传递它。只需要在渲染根组件使使用即可，这样一来，所有子组件就默认都可以拿到state了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-其他常用中间件及工具"><a href="#_4-其他常用中间件及工具" class="header-anchor">#</a> 4. 其他常用中间件及工具</h2> <h3 id="_1-开发调试工具-redux-devtools-extension"><a href="#_1-开发调试工具-redux-devtools-extension" class="header-anchor">#</a> 1. 开发调试工具：<a href="https://github.com/zalmoxisus/redux-devtools-extension#13-use-redux-devtools-extension-package-from-npm" target="_blank" rel="noopener noreferrer"><code>redux-devtools-extension</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>主要为日常开发提供Redux状态追踪：
<div class="img-wrapper"><img src="https://i.loli.net/2020/03/06/y6wg2RnHZVokAL1.gif" alt="redux-devtools-extension" class="zoom-img"> <p>redux-devtools-extension</p></div></p> <ol><li>Chrome安装 Redux Devtools 扩展工具，访问扩展商店安装即可</li> <li>项目中安装 <code>redux-devtools-extension</code> 插件<div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i -D redux-devtools-extension
</code></pre></div></li> <li>在代码中添加工具<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'redux-logger'</span><span class="token punctuation">;</span>
<span class="token comment">// 引入工具插件</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> composeWithDevTools <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redux-devtools-extension'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. 单独使用</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 结合其他中间件使用</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">[</span>thunk<span class="token punctuation">,</span> logger<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 只在开发环境使用</span>
<span class="token keyword">const</span> enhancers <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;development&quot;</span> <span class="token operator">?</span> <span class="token function">composeWithDevTools</span><span class="token punctuation">(</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span>
  <span class="token comment">// other store enhancers if any</span>
<span class="token punctuation">)</span> <span class="token operator">:</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> storeEnv <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>counters<span class="token punctuation">,</span> enhancers<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h3 id="_2-日志记录-redux-logger"><a href="#_2-日志记录-redux-logger" class="header-anchor">#</a> 2. 日志记录：<a href="https://github.com/LogRocket/redux-logger" target="_blank" rel="noopener noreferrer"><code>redux-logger</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>安装</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i --save redux-logger
</code></pre></div><p>使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>

<span class="token comment">// Logger with default options</span>
<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'redux-logger'</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-其他工具集"><a href="#_3-其他工具集" class="header-anchor">#</a> 3. 其他<a href="https://www.redux.org.cn/docs/introduction/Ecosystem.html" target="_blank" rel="noopener noreferrer">工具集<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">12/1/2020, 4:35:44 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/React/Redux基础.html" class="prev">
        Redux基础
      </a></span> <span class="next"><a href="/web/React/从零开始实现一个Redux.html">
        从零开始实现一个Redux
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8fcb3c07.js" defer></script><script src="/assets/js/2.ea4b5fde.js" defer></script><script src="/assets/js/26.cfb8865a.js" defer></script><script src="/assets/js/3.482fc7d1.js" defer></script>
  </body>
</html>
