<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react-router实现权限控制小记 | Seven&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="积跬步以至千里，积小流以成江海">
    
    <link rel="preload" href="/assets/css/0.styles.9a488dde.css" as="style"><link rel="preload" href="/assets/js/app.8fcb3c07.js" as="script"><link rel="preload" href="/assets/js/2.ea4b5fde.js" as="script"><link rel="preload" href="/assets/js/29.d97a3e56.js" as="script"><link rel="prefetch" href="/assets/js/10.ceaff0cb.js"><link rel="prefetch" href="/assets/js/11.602a1a57.js"><link rel="prefetch" href="/assets/js/12.7c9a3565.js"><link rel="prefetch" href="/assets/js/13.cb26c009.js"><link rel="prefetch" href="/assets/js/14.db9f58ed.js"><link rel="prefetch" href="/assets/js/15.c07f99aa.js"><link rel="prefetch" href="/assets/js/16.bbea5198.js"><link rel="prefetch" href="/assets/js/17.bd355204.js"><link rel="prefetch" href="/assets/js/18.069c6795.js"><link rel="prefetch" href="/assets/js/19.2d2f3f2c.js"><link rel="prefetch" href="/assets/js/20.4bf50484.js"><link rel="prefetch" href="/assets/js/21.1bfa4a30.js"><link rel="prefetch" href="/assets/js/22.9b54ca32.js"><link rel="prefetch" href="/assets/js/23.17047d1d.js"><link rel="prefetch" href="/assets/js/24.d36a307c.js"><link rel="prefetch" href="/assets/js/25.f5c553f3.js"><link rel="prefetch" href="/assets/js/26.cfb8865a.js"><link rel="prefetch" href="/assets/js/27.8d7291fd.js"><link rel="prefetch" href="/assets/js/28.ac3b40d5.js"><link rel="prefetch" href="/assets/js/3.482fc7d1.js"><link rel="prefetch" href="/assets/js/30.f58a4260.js"><link rel="prefetch" href="/assets/js/31.9294edd4.js"><link rel="prefetch" href="/assets/js/32.753d88bb.js"><link rel="prefetch" href="/assets/js/33.4259510b.js"><link rel="prefetch" href="/assets/js/34.767c2061.js"><link rel="prefetch" href="/assets/js/35.ee551374.js"><link rel="prefetch" href="/assets/js/36.67e65bf0.js"><link rel="prefetch" href="/assets/js/37.39a7a34a.js"><link rel="prefetch" href="/assets/js/4.6162bcf8.js"><link rel="prefetch" href="/assets/js/5.43fabd26.js"><link rel="prefetch" href="/assets/js/6.bfd296f5.js"><link rel="prefetch" href="/assets/js/7.da21fdf7.js"><link rel="prefetch" href="/assets/js/8.13301773.js"><link rel="prefetch" href="/assets/js/9.d46e2aae.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a488dde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Seven's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  web前端
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  web前端
</a></div><div class="nav-item"><a href="/utils/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>react-router</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/ReactRouter/拦截器配置.html" class="active sidebar-link">权限控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/ReactRouter/拦截器配置.html#_1-权限控制各端需要做的工作" class="sidebar-link">1. 权限控制各端需要做的工作</a></li><li class="sidebar-sub-header"><a href="/web/ReactRouter/拦截器配置.html#_2-前端权限控制实现" class="sidebar-link">2. 前端权限控制实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/ReactRouter/拦截器配置.html#_1-获取权限列表的时机" class="sidebar-link">1. 获取权限列表的时机</a></li><li class="sidebar-sub-header"><a href="/web/ReactRouter/拦截器配置.html#_2-控制菜单的展示" class="sidebar-link">2. 控制菜单的展示</a></li><li class="sidebar-sub-header"><a href="/web/ReactRouter/拦截器配置.html#_3-路由的控制" class="sidebar-link">3. 路由的控制</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>UmiJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Utils</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/web/Mobile.html" class="sidebar-link">Mobile</a></li><li><a href="/web/ElementUI.html" class="sidebar-link">ElementUI</a></li><li><a href="/web/FastMock.html" class="sidebar-link">fastmock</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-router实现权限控制小记"><a href="#react-router实现权限控制小记" class="header-anchor">#</a> react-router实现权限控制小记</h1> <h2 id="_1-权限控制各端需要做的工作"><a href="#_1-权限控制各端需要做的工作" class="header-anchor">#</a> 1. 权限控制各端需要做的工作</h2> <ul><li>前端：
<ul><li>菜单/按钮作为页面的入口，让用户直接操作就能进入到对应的页面，是需要做权限控制的；菜单通常是无权限直接就不展示，按钮分情况不展示或点击给出提示，结合具体的需求场景来实现</li> <li>路由权限控制：只控制菜单/按钮的不展示，并不完善，因为还可以通过输入URL来进入相应页面，而路由决定了能否进入当前页面，所以还需要前端对路由进行权限控制</li></ul></li> <li>后端：后端相对前端来说，权限控制更为重要，因为可以不通过界面而是直接通过接口来获取数据，所以后端必须对接口访问权限进行控制；同时如果对接口进行了控制，返回无权限状态码，前端同样可以根据状态码来进行重定向至无权限界面。</li></ul> <h2 id="_2-前端权限控制实现"><a href="#_2-前端权限控制实现" class="header-anchor">#</a> 2. 前端权限控制实现</h2> <h3 id="_1-获取权限列表的时机"><a href="#_1-获取权限列表的时机" class="header-anchor">#</a> 1. 获取权限列表的时机</h3> <p>应当是在用户登录后，内容页面展示之前获取权限列表，这样在展示具体页面前就把路由和菜单展示控制好。</p> <h3 id="_2-控制菜单的展示"><a href="#_2-控制菜单的展示" class="header-anchor">#</a> 2. 控制菜单的展示</h3> <p>有两种方式来控制菜单的展示：</p> <h4 id="_1-由前端控制菜单如何展示"><a href="#_1-由前端控制菜单如何展示" class="header-anchor">#</a> 1. 由前端控制菜单如何展示</h4> <p>此方式菜单信息由前端本地配置一个菜单表，后端只返回权限列表，结合后台返回的权限列表，对菜单进行权限赋值，如果有权限的情况下，菜单展示，无权限则直接不展示。因为菜单通常都是嵌套的，所以这里主要的实现就递归：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用递归菜单权限赋值，获取到有权限的菜单列表</span>
<span class="token keyword">function</span> <span class="token function">getMenuAuthor</span><span class="token punctuation">(</span><span class="token parameter">menuList<span class="token punctuation">,</span> resources</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  menuList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果包含子项，递归</span>
      <span class="token function">getMenuAuthor</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>children<span class="token punctuation">,</span> resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>resources<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 权限赋值</span>
      item<span class="token punctuation">.</span>authority <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> menuList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 菜单列表</span>
<span class="token keyword">const</span> menuList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Navigation One&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;item1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;comment&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub1/item1/option1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub1/item1/option2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;g2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;item2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;setting&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub1/item2/option1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub1/item2/option2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub2&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Navigation Two&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;item1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;comment&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub2/item1/option1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub2/item1/option2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;g2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;item2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token string">&quot;setting&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub2/item2/option1&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token string">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Option 2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;icon&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token string">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/sub2/item2/option2&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;children&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 权限列表</span>
<span class="token keyword">const</span> resourceList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;/sub1/item1/option1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/sub1/item1/option2&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/sub1/item2/option1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/sub2/item2/option1&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;/sub2/item2/option1&quot;</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-菜单由后台返回"><a href="#_2-菜单由后台返回" class="header-anchor">#</a> 2. 菜单由后台返回</h4> <p>这种方式前端不用再处理菜单配置，但是要同后台协商好菜单数据的返回形式。菜单完全由后台返回即可。</p> <h3 id="_3-路由的控制"><a href="#_3-路由的控制" class="header-anchor">#</a> 3. 路由的控制</h3> <p>在Vue项目中可以使用 <code>vue-router</code> 提供的路由守卫在跳转前后取消跳转的方式，来实现路由权限的控制。<code>react-router</code> 相对于 <code>vue-router</code>来说更为灵活，轻巧，所以没有内置这些API，但是基于它的灵活性，也可以实现类似导航守卫的功能。</p> <h4 id="_1-实现思路"><a href="#_1-实现思路" class="header-anchor">#</a> 1. 实现思路</h4> <p>主要思路是使用了 React 的 <a href="https://zh-hans.reactjs.org/docs/render-props.html" target="_blank" rel="noopener noreferrer"><code>Render Props</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，<code>Render Props</code> 相比于固定写死的组件来说更为灵活，可以动态的决定渲染的结果。正如官网所说：</p> <blockquote><p>render prop 是一个用于告知组件需要渲染什么内容的函数 prop。</p></blockquote> <p>react-router 内置了 <code>Render Props</code> ，使用 <a href="https://reactrouter.com/web/api/Route/render-func" target="_blank" rel="noopener noreferrer"><code>&lt;Route render&gt;</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来取代 <code>&lt;Route component&gt;</code> ，根据路由权限，动态修改当前路由要渲染的结果。</p> <h4 id="_2-实现方案"><a href="#_2-实现方案" class="header-anchor">#</a> 2. 实现方案</h4> <ol><li>首先，将所有的路由信息放在一起，构建一个路由表：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> routerMap <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/home</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> component<span class="token operator">:</span> HomePage<span class="token punctuation">,</span> exact<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/test/page1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> component<span class="token operator">:</span> Page1<span class="token punctuation">,</span> exact<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/test/page2</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> component<span class="token operator">:</span> Page2<span class="token punctuation">,</span> auth<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 白名单页面</span>
  <span class="token punctuation">{</span> path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/exception/403</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> component<span class="token operator">:</span> Exception<span class="token punctuation">,</span> auth<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>这样，就能通过遍历的方式输出所有的路由信息，而且方便在遍历时进行一些统一操作。对不需要权限控制的页面组件，设置 <code>auth:true</code> 即可设置白名单。<br>
2. 遍历路由信息，为有权限的路由进行赋权。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 遍历路由，权限赋值</span>
<span class="token keyword">const</span> authRouterMap <span class="token operator">=</span> routerMap<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> itemCopy <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      itemCopy<span class="token punctuation">.</span>auth <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> itemCopy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>使用 Route 组件的 <code>render prop</code> 渲染组件</li></ol> <div class="language-JSX extra-class"><pre class="language-jsx"><code><span class="token operator">...</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span>
      <span class="token attr-name">path</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span>
      <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token comment">// 重定向至第一个有权限的界面</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>routerMap<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>auth<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">exact</span>
    <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>
      routerMap<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Route
          key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span>
          path<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>path<span class="token punctuation">}</span>
          exact<span class="token operator">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>exact<span class="token punctuation">}</span>
          render<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>auth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 如果有权限就渲染对应的页面组件</span>
              <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item.component</span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 如果无权限就渲染重定向至403页面</span>
            <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> pathname<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/exception/403</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果使用了 render 函数，就不能再使用 component 的方式了，因为 component 的方式要优先于 render ，render 会被覆盖掉。</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2/9/2021, 2:59:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/React/从零开始实现一个Redux.html" class="prev">
        从零开始实现一个Redux
      </a></span> <span class="next"><a href="/web/UmiJS/plugins.html">
        插件相关
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8fcb3c07.js" defer></script><script src="/assets/js/2.ea4b5fde.js" defer></script><script src="/assets/js/29.d97a3e56.js" defer></script>
  </body>
</html>
